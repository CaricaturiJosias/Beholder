#!/usr/bin/python3
import requests
from time import sleep
import xml.etree.ElementTree as ET

url = "http://localhost:12332"

# headers
headers = {
    'Content-Type': 'text/xml; charset=utf-8'
}

# def print_dam():
#     print("""
# ..........::::...:::::::...........:::....::::::::::::::::::::::::::::........::::::::::::::::::::::::::::::::::::---------------------------::::::--::--::::::::::::::::::::::::-------::::::::-::::::::::::.....:::::::::::.
# ..........:::::::::::::-:..::::....::...........::::::::::---:::::::::::::::::::::...:::.::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::..::::---:::.
# .............:::::::::::::::::::::-:::::::::::::.......::..::::::::::::::-----:-------------:::::::::::::::::::::---::----:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::.
# ....................:::::::::::---:::::::::::::::::::::........:...:.....::::::.::::::::::::::::::::::::::::--:::::----:----::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::.::::.
# ..:::.................::::::::::::::::::::::::::----::::::::::::::::::::....:......:......:::------------------::...::....::::::----------------------------------------:::::::.::::::::::::::::::::::::::::::--:::::.:::::::.
# ......:::...............:::::::::::::::::::::::::::::::-----::::::-------::::::::::.....:::::::::----::=#%#=:---:::::::::::::::------------------------:::::--::--------------------:----::...+#*.:::::::::::::::....:::......
# ..........:.........................::.:::::::::::::::::::::::::--::::::::::::-:::::::::--:::.-#@@@@@@@@@@@@@@=-----------:::---::.:::::::......:..::--:.:::::::-----:---::-----::::.:--:.:-:=@@@+:...::.::-+*#%\%##*=-:-#%*::.
# ...........:::::::::..........:.........::.......::.....::::::::..:::::::::::--:::::--::-=@@@@@@@@@@@@@%+-*@@@@@%=:::::---::.:.+*+-:.::::.:::.:-+*#%@@@@@@@%*++-+=-:---:-=@@@@@#+-:=#@@%+=++=#@#@@--+#%\%\%@%+--=----==:-+@@@=:.
# .....:.........::::::::::::::.:+#+::.:::-=-::.:...:-==+%@%=:.....:::.=@@@@@@@@@@@@@@@@@@@@@@@@@@*+*+-+--:-::-#@@@@@@#:.::.-+@@@@%@-+%\%#*--#@%\#%@@@@@@@@@@@@@@@@###@@@#-=%@@@@@@@@@@@@=#@@@@@@@@+@@=@@@@@%*\%\%=*##++:*--*@@*@%-.
# ..............::::::.::::::::::@#@::::::*+#..-+*@@@##@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-:==--=+%*+=:::-#@#=-%@@@@@@@@@@@@@%==@@@@@@@@@@@@@@@@@@%+:--+==#@@@@@@@@@@@@@@*=+*#@@@@@@#@%@@@@@@%=@@@@@%\#%\%##@@@%@%@@@@@@@#*@@@.
# ...::::::-=**+*+=*@@#==+*==+=-=@-@#%=--#@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@=::..::::...:..:::::=-=....:+%\%#+-.-+-*=-==:+@@@@@@@@%\%@#@@@@%\#%@@@@+*%\%#+-------+**#++#@@%*=*@@@#====+++#*+=@@@%-=**=--.@@@*:--=#@%\%@@@@@#-=#@@#.-#@@.
# .%*#@@@@@@@@@@@@@@%\%##**###%@@@@#@@@@@@@@@@@@@@@@*#@@%\%@@+-.:::::::::::..........:.......::-=-:::....:=+**#@@@*====+=--===---+@@@+==--====-=----..:::-:.:==:==-:-----::--.---:::..::#=%+....::-:%=*:.....::=*%@@%\%###*+-..-=+.
# .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@==#=====--:..:::::.:::...:...............:....................:-=+++=--::-=-:-=--:......:::----::::---:-----=----:--::--==--::..::-----:--:-@=@-:....--.%=#-==-:::::.----+##+==.:--:-.
# .@@@@++#*+*##*++#%@@@@@@@@@@%*=%@@@@@@@@%=%-.::::-:--------------:::::--------::::..............::.-=--::::...............:.......-=:-========-:::-::::----====-----:-.:-:::::-::--#@@@+%@@%\%*=.++=:--=.::::.-:-::::--:-:-:::.
# .-----------:---+@@@@@@@@--*#@@@@@@@@@@@@@@@%-::::#@@#-.::::::.:::::..::::::#@%=:::---::..::.::-+*++=++%@@*+==+=--=----::-====--:-+=++*+==-.:.---:----------=+++*+##%\%+:-:.-:::::--@@@@*@@%+*#+:===@@@%#\####%#\##%\%\%+=:.-:--::.
# .-::::-::.:.:.:-@@@@@@@@@-=+=@@@%@@@@@@@@@@@@=-==+@@%@@@@@@@@@@@%++++++*#%@@@@@@@@%###***###%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#@#%@=.--@@@@@@%@@@@@%@@@@%*=:=---:-.
# .:..--:::::::::#@@@@%\%@@@@@@@@@+@@@@@#@@%@+@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#@-@@%@+-*%@@-.-=@@@%@#++==-#+#+-@#+=--.:---.
# .@@@@@@@@@@@@@@@@@@@@@@@+@@@%-@@@@@@@@@@@@@@#+==@#@@+@@@@@@@@@%=#%=-*+##:=+=--=-@@#+=--=-%@%\%\%*@#+%@@@@@+@%@@@@@@@%\%#+::-#@@@@@@@@@@@@@@@@@@@@@@@@@*--+-%@@@@@@@@@@@@@@@@@@@@@@@@@@@%#@@@@@@@@=::-+@@@@@@@@@@@@@@@@%*=--.:--:.
# .#####+*#%@@@@@%\#%@@@@@@@@@@@@@@@@@@@@%-\%@@@@@@@@@@@@@@@@@@#.=#*:%@@@@@@@@@@@%@@@@@@@%#\%@%=*%@@@@@@@@@@@@@@@@@@@@%*\%\%=---@@@%@@@@@@@@##@@@@@@@%##@@@--%@@@@@@@@@@@@@@%@@@@@@@++@@#+==:#@@@@@#+=-:--*##==#@@@%*++#%*-.:::::-.:.
# .:---=+##==-:+%#=#:+=+====-=+@#=-.-*%\%#=@@==--*%\+%*:-@%==:##+=##:@@+=:#%===@*-*@%=+#=---@@--%@@=*++===@%-#@@:#**++++@%#:*@@%###*#*+@%=.#@#%\%\%\%#\#%\%@@=-@@@%\%\%\%\%\%\%\%\%@#+=+%\%\%@@@@@@#***+::--=+*#+=-:=--==-:---------::--::::--:..
# .=++===:+==++#:+==++=-::..=#@@+--::-@@=%@@=--===+@+:#@#+:-=++@@=:@@*--=**+%@=:@@%-==++++@@-=@@-==++===@@++@@-+***+++@%\%-+@@#%##***+@@--%@*#%\%\%\%#=-@@*-%@@#%\%\%\%\%*-+@+:-%@%\%\%\%#\#%+-##*#+==:=#++==---=---.:::-----:.:::::-:.::-..
# .#*%\%+-:++#%+=@%=---==---=%-@@=---::@@-@@@=-=-==%@=-%@+----==@@--@@*-=-==-@@:-@@*-=-=--=@@-:@@:=--=--=@@==@@---=====@@#--@@------=+@@==@@*#+===#@@@@%+\%@@*=====#%+@*+##@#=-===+#%+#=%+==::+%#=--==+----.::-.:--:::::::::-::::.
# .=--=+-=++*+@@-+=:=+*=-=-%#@@#-=:-:-@@:%@@==+--=@%-*@@=.=----@@-=@@+-=----@@::@@=+--=:--@@-+@@-=:--:-=@%++@@:----::-@@+=#@#:--:::==@#--@#=+====**-@@%=#@@#-===-++-@*+.=%#=-=--++==*-#:=+-:---==-=-+--:-::----:::.:::::::-.:-:.
# .==-=+===+#@*-==-==-.::-##=@@===---#@%-=@@-*+===%#=+@@==*---:@@-=@@===--:-@@==@@-*-:=:-=@%-*@@=-.-.:--%#--@@:=-=--:-@@=+%@=::-::.==@#--@#=*====*+-@@%=*#@%---====-@##==%\%-----===+==#-+#=.--::-=++=-:--.-=-:---::::--.::::=+=.
# .:-=+=----=-#*--==---:-++=+@@-.-=--@@-+@@*@@@@@@++#@@%\%@@@@@@@%*\%@@@@@@@@@#+%@@@@@@@@@@%*\%@@@@@@@@@@@@*+++@@%@@@@@@@@@#*@@+@@@@@@@@#+*+%==#@@@@@%#\#%#-=-@@@@@@@%#+@=*==##+#%\%#**+#:===:++---::-.--=-::::--.--:..::.------+*==.
# .=+=:=====+#+----.:::-==--*@@-==-::@@+=+@@@@@@@@*===+@@@@@@@@=#@+@@@@@@@@@@+==+@@@@@@@@@%*\%##@@@@@@@@@%=**-@@@@@@@@@@+@@#%@@@@@@@@@#+**+@@@@@@@#+#%-++*@@@@@@@%\%##=#%++=++##%\%\#%\#%\%+-=-==--====-:.::-----:.-----:-:----=*%+=-.
# .=--=+==++=-=+=-:-=-:==--:@@==-----%#=@@@@@@@@@@@==@@@@@@@@@@@#-@@@@@@@@@%@%=%@@@@@@@@@@@=-@@@@@@@@@@@@%-=@@@@@@@@@@@@-=@@@@@@@@@@@@@*+@@@@@@@@@@@@@#*+@@@@@@@@@###@+++=#@#**#%@@@@@%---=:-======--=-::-======++==-:-:-=+==+:.
# .--++=-+=:----::-=---==:-#%*#*+=-=*+#@@@%:-==%*@@*@@@@@@-%@+@@=@@@@*=-%@*@@#%@@@*====#=@@-+@@@@-+=-+@@@@*%@@@#-=-:*@@@+=@@@@@###%@@@@=-@@@+%@@@@@@@@@=+@@#@@@@@@@@@@%=+@@@@@@@@@@@@@@-==---:--======----=-----=-==----=+==+=:.
# .----==--=:::-.-++-==--=%@-=+==-=#+-@@@#=-==@@%@@@@@#@#-@@@#@@+@@@+==@@#=@@-@@@+=+++@@#@@=@@@#+#%**@@@@@+@@@#+*+==##@@=@@@=++*#*=@#@@:%@@==+*##*+++@@-@@@+*++++#%##@@=+@@@@@@@%*+--@@@==----=--=-=---:.:--.----:-----=:+====-.
# .-==+=-=+=:::------=---+%-#-+=:-+*+@@@%=-=-@@#@@=@@%\%#-@@@%#@@@@@*-=#@@*#@@#@@#====#@%\%@@+@@#%=%*+*@#@@#=@@%+#*#++%\%@@-@@@##+#*#+@*@@:@@@==+++*###+@@=@@%\#%\%\%@@@@%#@@=:@@+:+--:-++++@@----:--+-+-:::-:-------=:=:--------+--:.
# .-+*=-+#-+-:--=--=+----==*-++-===+@@@@=-+-#@=#@@@@@%\%=+@@=@#@#@@%+-=@@+=%@%@@@+---=%@+#@@@@@+#*%==#@+@@-#@@#=*=*++%\%@@+@@=+#+#=#+@*@@=@@@======++++@@%@@*#%\%\%\%\%\%##*@@@-@@-:+=---=+==@@#:::.:--=.=-:---===+=:.+:=-----:::---:..
# .-#+++#=+=-====:-.-====::-+=:=@@@@@@@@##+-#*+@@@@@@@#-#@@@@@@@@@*--=%#=-%@@@@@=:::-#++%@@@@%#=#+--#*:@@#@@@*-=-+=+*+@@@@@--*-*:*#@=@@+@@@-==------=%@@@@+**++++++===@@=@@=-=+-=-=+=-+@@-:.:---:+==:-::=+--==-=-=-----:::::---.
# .-+++==.++=--==-=+#*+==+++:*@@@@@@@+:::-+%#\--%@@@@+-=#%*-=-#@@%=-:--+#%\%@@@@@+---=+#%@@@@@@##-####@@@@@@@@@#*###++*#@@@@@++#=+=+#@=@@@@@%:------::-+@@@%======------@@*@@+-=+:=--++--@@=:.::-:-=-=:::--+*#*+=--------:.--:::-.
# .-=*+++++====---++=---==-+%@@@@*+#@@@@@@@@@*====*%@@@@@@@#--=*####%@%*+=-#+-=+#*+*%\%##*-#+===++:--=-:+@@@@=--:---==:@@@@=+++-+=-*@@@@@@@+--======--=%@#=----:-++++==%@@@@=:-=---=++=-%@@#+------:-------=--:--==+--:-::..:.::.
# .-.--:--+*##+=-=-:::::-+%@@@*=++#@@%\#%@@@++=+#%@@@@@@@@#*++#%@@@%@@@@@@@@%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%+#@@@@@@@@@@@@%\%\%\%#\#%#+*#*:+#@@@==++===++====---===--:--=++==*@@@+--=+#*==+=-=#@@@@@@@@@#=:--==:.:::::-::-------::----.
# .:--:.-::-:---::::--=*@@@@*==-=*#+==+%\%=+#-+*++**+*%@=#%==**##+++%\%+==-=++*#%\%\#*%@%**++*%\%###@@@@@@@%\%\%\#%\%\#%@@@@@@@@@@@@@@@@@@@@@@%##\###%\%\%\%\%\%\%\%#\#%\%\%\%#++++==+*+=====-=+===+**#%\%*=---=+*%@@@@@@@@@@@%+-::::-----====--::----.
# .:::--::-=+**+#@@@@@@@@@#+=--::--===-++##=:----==++#%@@*:-::-----=======:--==-==##-===+++===##=++%#-*#+*++=#*++++%=**+++*##*##%###***+***+++++==++=++++=-----==++======+*+=----======+===+++==:*@@@@@@@=::-----------::---:::.
# .@@@@@@@@@@@@@@@@#*+=--===++*#**#@@@%+-===-:::::.:-+*=---:--::.::-===--:.:---=-:=***=-.:-==:==++=*#@@*====:====--+===---==-==++-=+=+=======-=-----------:::-----=---------=----:--------::-==+==+++==@@+-:::::::..::..::::.:..
# .===------::-+#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#####*+=====+**++=---=--:-------=+=-----=+=:..:-=-:-::-=++=--.:---:-==+=:------------::::::..::::---:::-:::::::::::--:--::::::::::--===+#%@@@=-::.::::..::.......::.
# .%@@@@@@@@@@@@@@@%\%#\#%\%\%@@@@%\%\%\%*=--=+#%@@@@@@@@@@@@%#\%@@@@@%\%\%\%#**#%@@@@%#\##%@@@@%\%#**######%@@@@@@@@@@@@@%**#%\%#++\#%\%#+=-=--::-======----------------------:::::::::.....::::::::::::::::::--=-=+#@@+---::::.::.......:.::..
# .--::::----:::-::::::::::::::---------==+=====+*++*####%\%@@@%\%##\#%\%@%###\#%\%@@@@@%\%#########*+#%@@@@@@@@@@@@@@@%\%\%@@@@@@@@@@@@%\%\%\%####*+++==----=----=------------------::---------:--------::---===++==----:-:..:::..::::.:...
# ...::--::::...:...:::::::::--:::---====----::------=**+===+++++++*##++=+#%\%@@%*+=+*##%##*++##%#**###%\%@%\%\%\%@@@%#*+##+++#%@@@@@@@@@%\%##*+==---------------------::-:::::----------::----------------==+++=-----:.:::.::......:.
# .-------::::::::::::::::.....:::..::--==============-------:--=======***+==----==========-=++=-::-------==--==++++=======++*##%\%\%\%\%\%##*+=-------------------:::....:..:--::::-:...::::-::------------=+*##++==-:::::.......::.
# .:::---:.....:::--:::..::::::::----::..:--==---:--::::----::---======----:::::..:-::----=+++=--:------:::::::----=---:::---===++++++**++=--:::---------------::::::::.:::..:::.::::::::..:--------
#           """)

def generate_default_payload():
    return """
<?xml version="1.0" encoding="UTF-8"?>
<SOAP-ENV:Envelope
    xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"
    xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:bhldr="http://tempuri.org/bhldr.xsd">
 <SOAP-ENV:Body>
  <bhldr:lookup>"""

def end_payload(payload):
    return payload + \
"""</bhldr:lookup>
 </SOAP-ENV:Body>
</SOAP-ENV:Envelope>"""

def add_request(current_request, name):
    return current_request + \
f"""
    <input>
        <infoName>{name}</infoName>
        <timestamp></timestamp>
    </input>""" 

item_analog_list_n = [
    'P',
    'PF',
    'F',
    'Vv',
    'ED',
    'EPGen',
    'EFGen',
    'PFGen'
]

item_analog_list = [
    'P',
    'PF',
    'F',
    'ED',
    'EPGen',
    'EFGen',
    'PFGen'
]

item_digital_list_n = [
    'P_QC',
    'F_QC',
    'T',
    'Area_'
]


def increment_payload_n(payload, items, n):
    if n == 0:
        name = ""
    else:
        number = f"{str(n)}"

    for item in items:
        payload = \
            add_request(
                payload,
                (item + number))
    return payload

def parse_n_resp(response):
    root = ET.fromstring(response.content)
    print(root)
    namespaces = {
        'SOAP-ENV':"http://schemas.xmlsoap.org/soap/envelope/",
        'SOAP-ENC':"http://schemas.xmlsoap.org/soap/encoding/",
        'xsi' : "http://www.w3.org/2001/XMLSchema-instance",
        'xsd' : "http://www.w3.org/2001/XMLSchema",
        'bhldr' : "http://tempuri.org/bhldr.xsd"
    }
    data = root.find('.//Envelope', namespaces=namespaces)
    print(data)

def simulationLoop():
    while (True):
        payload = generate_default_payload()

        for n in range(1,20):
            # payload = increment_payload_n(payload, item_analog_list_n, n)
            payload = increment_payload_n(payload, item_digital_list_n, n)
        # payload = increment_payload_n(payload, item_analog_list, 0)

        payload = end_payload(payload)
        print(payload)
        try:
            response = requests.request("POST", url, headers=headers, data=payload)
            if (response.ok) :
                print("Requisição bem sucedida")
                parse_n_resp(response)
            else :
                print(f"Response not ok: {response.status_code}")
                print(response.content)
        except Exception as e:
            print(f"Error: {e}")
        sleep(10)

def main():
    simulationLoop()
main()

